"use strict";!function(){angular.module("cn.forms",["ui.router","cn.ui","cn.flex-form"])}(),function(){function e(){return{restrict:"E",templateUrl:"cn-forms/templates/cn-forms.html",transclude:!0,scope:{config:"=ffConfig",model:"=ffModel"},controller:n,controllerAs:"vm",bindToController:!0,link:function(e,n,o){n.on("keydown",function(e){13===e.keyCode&&e.preventDefault()}),e.$on("$destroy",function(){n.off("keydown")})}}}function n(e,n,o,a,s,r,c,t){function i(){}function f(o){if(y.activateOffscreen=!1,y.config.getScope=y.config.getScope||function(){return n},y.config.formCtrl=y.cnForm,y.config.buttonContainerClass="page-action-btns",y.config.isDisabled=l,m(y.config),y.config.schema)try{y.compiled=!1,e.compile(y.config.schema,a.page),y.pageIndex=e.getPageIndex(),y.page=e.getPage(),y.compiled=!0,y.page.errors&&(y.page.errors=0,s(function(){n.$broadcast("schemaFormValidate")})),y.renderedPages=_.reduce(y.config.schema.forms,function(e,n,o){return _.set(e,o,_.eq(y.pageIndex,o))},{})}catch(t){r.error("There was an error with your form data:",t.message)}finally{y.activateOffscreen=!0}c.search().sandbox&&(y.schemaStr=angular.toJson(y.config.schema),y.sandbox=!0)}function m(e){y.styles=e.styles||{},y.styles.head=y.styles.head||e.isModal?"modal-header clearfix":"cn-form-head cn-heading row vertical-parent",y.styles.offset=!y.styles.offset&&!e.isModal&&0,y.styles.body=y.styles.body||y.styles.offset===!1?"":"cn-form-fixed",y.styles.col1=y.styles.col1||e.isModal?"":"col-sm-2",y.styles.col2=y.styles.col2||e.isModal?"":"col-sm-6",y.styles.col3=y.styles.col3||e.isModal?"":y.config.schema.forms?"col-sm-4":"col-sm-6",y.styles.nav=y.styles.nav||e.isModal?"":"nav-stacked",y.styles.cols=y.styles.cols||e.isModal?2:3}function l(e){return e.isDisabled?e.isDisabled(d):d(e)}function d(e){return y.saving||y.cnForm.$invalid||(!(e&&e.allowPristine)||!y.activateOffscreen)&&y.cnForm.$pristine}function g(){y.activateOffscreen=!0}function v(e,o){y.loadOffscreen(),n.$broadcast("schemaFormValidate"),n.$emit("schemaFormValidate"),!e.$valid&&!y.config.allowInvalid||y.saving?_.each(y.config.schema.forms,function(e){y.validatePage(e,e===y.page)}):(y.saving=!0,o(y.model).then(function(e){y.config.formCtrl.$setPristine(),y.saving=!1},function(e){y.saving=!1}))}function u(e,r){n.$broadcast("schemaFormValidate"),y.page!==y.config.schema.forms[y.pageIndex]&&(y.page=y.config.schema.forms[y.pageIndex]),y.validatePage(y.page),a.page=e.key,o.go(o.current.name,a);var c=y.page;y.page=e,y.pageIndex=r,y.renderedPages[r]=!0,n.$emit("flexForm.updatePage",e.key),n.$broadcast("flexForm.updatePage",e.key),s(function(){n.$broadcast("schemaFormValidate"),y.validatePage(y.page),y.validatePage(c)})}function p(e,n){var o=y.config.formCtrl[e.key];if(o&&Object.keys(o.$error).length>0){console.error("curForm.$error:",o.$error);var a=_.chain(o.$error).reduce(function(e,n){return e.concat(n)}).uniq("$name").reject({$name:""}).value();a&&a.length?e.errors=!n&&a.length:e.errors=0}}function h(){y.schemaStr&&(y.config.schema=angular.fromJson(y.schemaStr))}n.__tag=new i;var y=this;y.activate=f,y.loadOffscreen=g,y.submit=v,y.updatePage=u,y.validatePage=p,y.cleanupEvent="cn.forms.cleanup",y.formKey=a.page,y.schemaStr="",y.onSandboxSchema=h,n.$watch(function(){return!!y.config.schema},y.activate),n.$on("$destroy",function(){n.$broadcast(y.cleanupEvent),n.$emit(y.cleanupEvent),e.destroy()})}angular.module("cn.forms").directive("cnForm",e),n.$inject=["cnFormsService","$scope","$state","$stateParams","$timeout","$log","$location","$compile"]}(),function(){function e(e,n){function o(){}function a(o){var a=o.excludedPage?"{page:(?!"+o.excludedPage+")[^/]*}":":page",s=["debug","sandbox"].concat(o.queryParams||[]).join("&");e.state(o.name,{"abstract":!0,url:o.baseUrl+"?"+s,controller:o.controller,controllerAs:o.controllerAs||"vm",resolve:o.resolve,permissions:o.permissions,params:o.params,templateUrl:o.templateUrl,reloadOnSearch:!1}).state(o.name+".page",{url:"/"+a,permissions:o.permissions,template:"<ui-view/>"}),n.addStates(o)}var s={addStates:a,$get:o};return s}angular.module("cn.forms").provider("cnFormsRoutes",e),e.$inject=["$stateProvider","cnFlexFormRoutesProvider"]}(),function(){function e(){function e(e,o){r.schema=e,n(o)}function n(e){if(r.schema.forms)for(var n=0,o=r.schema.forms.length;n<o;n++){var a=r.schema.forms[n];if(e===a.key){r.form=a,r.formIndex=n;break}}else r.form=r.schema.form}function o(){return r.form}function a(){return r.formIndex}function s(){r.form=null,r.schema=null,r.formIndex=null}var r={compile:e,getPage:o,getPageIndex:a,update:n,destroy:s};return r}angular.module("cn.forms").factory("cnFormsService",e)}(),angular.module("cn.forms").run(["$templateCache",function(e){e.put("cn-forms/templates/cn-forms.html",'<form name="vm.cnForm">\n  <section class="{{vm.styles.head}}">\n    <cn-flex-form-header\n      ff-header-config="vm.config"\n      ff-submit="vm.submit(vm.cnForm, handler)"\n      ff-load-offscreen="vm.loadOffscreen()"\n    />\n  </section>\n  <div\n    class="cn-form cn-form-cols-{{vm.styles.cols}} {{vm.styles.body}}"\n    cn-responsive-height="{{vm.styles.offset}}"\n    cn-responsive-break="sm"\n  >\n    <div class="cn-form-inner">\n      <div\n        ng-if="vm.config.schema.forms"\n        class="cn-form-nav {{vm.styles.col1}}"\n      >\n        <div\n          class="cn-form-nav-inner"\n          cn-parent-width\n          cn-responsive-height="{{vm.styles.offset}}"\n          cn-responsive-break="sm"\n        >\n          <ul class="nav nav-pills {{vm.styles.nav}}">\n            <li\n              class="{{page.key === vm.page.key ? \'active\' : \'\'}}"\n              ng-repeat="page in vm.config.schema.forms"\n            >\n              <a ng-click="vm.updatePage(page, $index)">\n                {{page.title || page.key | titleCase}}\n                <span class="badge has-error" ng-show="page.errors"\n                  >{{page.errors}}</span\n                >\n              </a>\n            </li>\n          </ul>\n        </div>\n      </div>\n\n      <div class="cn-form-body {{vm.styles.col2}}">\n        <div\n          class="{{$index !== vm.pageIndex ? \'offscreen\' : \'\'}}"\n          ng-if="vm.config.schema.forms"\n          ng-repeat="form in vm.config.schema.forms"\n        >\n          <cn-flex-form\n            ff-form-index="$index"\n            ff-form-name="form.key"\n            ff-config="vm.config"\n            ff-model="vm.model"\n            ff-delay-form="!vm.renderedPages[$index] && !vm.activateOffscreen"\n            ff-cleanup-event="vm.cleanupEvent"\n          >\n          </cn-flex-form>\n        </div>\n\n        <cn-flex-form\n          ng-if="!vm.config.schema.forms"\n          ff-form-index="$index"\n          ff-form-name="vm.formKey"\n          ff-config="vm.config"\n          ff-model="vm.model"\n          ff-cleanup-event="vm.cleanupEvent"\n        >\n        </cn-flex-form>\n\n        <!-- sandbox for debug mode -->\n        <fieldset ng-if="vm.sandbox">\n          <legend>Sandbox</legend>\n\n          <div class="form-group">\n            <label class="control-label" for="schema">Form Data</label>\n            <textarea\n              id="schema"\n              class="form-control"\n              ng-model="vm.schemaStr"\n              rows="14"\n            >\n            </textarea>\n          </div>\n          <div class="form-group">\n            <button class="btn btn-primary" ng-click="vm.onSandboxSchema()">\n              Update Form\n            </button>\n          </div>\n        </fieldset>\n        <!-- end sandbox -->\n      </div>\n\n      <div ng-if="vm.styles.cols > 2" class="cn-form-meta {{vm.styles.col3}}">\n        <div\n          class="cn-form-meta-inner"\n          cn-parent-width\n          cn-responsive-height="{{vm.styles.offset}}"\n          cn-responsive-break="sm"\n          cn-set-max-height="true"\n        >\n          <div ng-bind-html="vm.config.schema.meta" />\n          <div ng-transclude />\n        </div>\n      </div>\n    </div>\n  </div>\n</form>\n<div ng-if="!vm.config.isModal">\n  <ui-view />\n</div>\n\n')}]);
//# sourceMappingURL=all.min.js.map
