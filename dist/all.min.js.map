{"version":3,"sources":["all.min.js","_cn-forms.module.js","cn-forms.directive.js","cn-forms.routes.js","cn-forms.service.js","templates.js"],"names":["angular","module","cnForm","restrict","templateUrl","transclude","scope","config","model","controller","Form","controllerAs","bindToController","cnFormsService","$rootScope","$scope","$state","$stateParams","$timeout","$log","$location","$compile","cnFormTag","activate","watch","vm","activateOffscreen","getScope","cols","formCtrl","buttonContainerClass","isDisabled","schema","compiled","compile","page","pageIndex","getPageIndex","getPage","errors","$broadcast","renderedPages","_","reduce","forms","acc","value","index","set","eq","e","error","message","search","sandbox","schemaStr","toJson","btnConfig","isFormInvalid","saving","$invalid","allowPristine","$pristine","loadOffscreen","console","log","submit","form","handler","$emit","$valid","allowInvalid","each","validatePage","then","response","$setPristine","rejection","updatePage","key","go","current","name","noBadge","curForm","$error","chain","left","right","concat","uniq","reject","$name","length","onSandboxSchema","fromJson","__tag","this","cleanupEvent","formKey","$watch","$on","destroy","directive","$inject","cnFormsRoutesProvider","$stateProvider","cnFlexFormRoutesProvider","$get","addStates","options","pageParam","excludedPage","queryParams","join","state","abstract","url","baseUrl","resolve","permissions","params","reloadOnSearch","template","provider","service","update","i","l","formIndex","factory","run","$templateCache","put"],"mappings":"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","file":"all.min.js","sourcesContent":["'use strict';\n\n(function () {\n  'use strict';\n\n  angular.module('cn.forms', ['ui.router', 'cn.ui', 'cn.flex-form']);\n})();\n'use strict';\n\n(function () {\n  'use strict';\n\n  angular.module('cn.forms').directive('cnForm', cnForm);\n\n  function cnForm() {\n    return {\n      restrict: 'E',\n      templateUrl: 'cn-forms/templates/cn-forms.html',\n      transclude: true,\n      scope: {\n        config: '=ffConfig',\n        model: '=ffModel'\n      },\n      controller: Form,\n      controllerAs: 'vm',\n      bindToController: true\n    };\n  }\n\n  Form.$inject = ['cnFormsService', '$rootScope', '$scope', '$state', '$stateParams', '$timeout', '$log', '$location', '$compile'];\n  function Form(cnFormsService, $rootScope, $scope, $state, $stateParams, $timeout, $log, $location, $compile) {\n    function cnFormTag() {}\n    $scope.__tag = new cnFormTag();\n\n    var vm = this;\n\n    vm.activate = activate;\n    vm.loadOffscreen = loadOffscreen;\n    vm.submit = submit;\n    vm.updatePage = updatePage;\n    vm.validatePage = validatePage;\n    vm.cleanupEvent = \"cn.forms.cleanup\";\n    vm.formKey = $stateParams.page;\n\n    // debug\n    vm.schemaStr = '';\n    vm.onSandboxSchema = onSandboxSchema;\n\n    $scope.$watch(function () {\n      return !!vm.config.schema;\n    }, vm.activate);\n\n    $scope.$on('$destroy', function () {\n      $scope.$broadcast(vm.cleanupEvent);\n      $scope.$emit(vm.cleanupEvent);\n      cnFormsService.destroy();\n    });\n\n    //////////\n\n    function activate(watch) {\n      vm.activateOffscreen = false;\n      vm.config.getScope = vm.config.getScope || function () {\n        return $scope;\n      };\n      vm.config.cols = 3;\n      vm.config.formCtrl = vm.cnForm;\n      vm.config.buttonContainerClass = \"page-action-btns\";\n      vm.config.isDisabled = isDisabled;\n\n      if (vm.config.schema) {\n        try {\n          vm.compiled = false;\n          cnFormsService.compile(vm.config.schema, $stateParams.page);\n          vm.pageIndex = cnFormsService.getPageIndex();\n          vm.page = cnFormsService.getPage();\n\n          vm.compiled = true;\n\n          if (vm.page.errors) {\n            vm.page.errors = 0;\n            $timeout(function () {\n              $scope.$broadcast('schemaFormValidate');\n            });\n          }\n\n          vm.renderedPages = _.reduce(vm.config.schema.forms, function (acc, value, index) {\n            return _.set(acc, index, _.eq(vm.pageIndex, index));\n          }, {});\n        } catch (e) {\n          $log.error('There was an error with your form data:', e.message);\n        }\n      }\n\n      // sandbox\n      if ($location.search().sandbox) {\n        vm.schemaStr = angular.toJson(vm.config.schema);\n        vm.sandbox = true;\n      }\n    }\n\n    function isDisabled(btnConfig) {\n      return btnConfig.isDisabled ? btnConfig.isDisabled(isFormInvalid) : isFormInvalid(btnConfig);\n    }\n\n    function isFormInvalid(btnConfig) {\n      return vm.saving || vm.cnForm.$invalid || (!(btnConfig && btnConfig.allowPristine) || !vm.activateOffscreen) && vm.cnForm.$pristine;\n    }\n\n    function loadOffscreen() {\n      console.log('vm.activateOffscreen:', vm.activateOffscreen);\n      vm.activateOffscreen = true;\n    }\n\n    function submit(form, handler) {\n      console.log('submit:');\n      vm.loadOffscreen();\n\n      $scope.$broadcast('schemaFormValidate');\n      $scope.$emit('schemaFormValidate');\n\n      if ((form.$valid || vm.config.allowInvalid) && !vm.saving) {\n        vm.saving = true;\n        handler(vm.model).then(function (response) {\n          console.log('submit:response:', response);\n          vm.config.formCtrl.$setPristine();\n          vm.saving = false;\n        }, function (rejection) {\n          vm.saving = false;\n        });\n      } else {\n        _.each(vm.config.schema.forms, function (page) {\n          vm.validatePage(page, page === vm.page);\n        });\n      }\n    }\n\n    function updatePage(page, pageIndex) {\n      $scope.$broadcast('schemaFormValidate');\n      // if the forms re-render these will no longer be the same reference\n      if (vm.page !== vm.config.schema.forms[vm.pageIndex]) {\n        vm.page = vm.config.schema.forms[vm.pageIndex];\n      }\n\n      vm.validatePage(vm.page);\n\n      $stateParams.page = page.key;\n      $state.go($state.current.name, $stateParams);\n      vm.page = page;\n      vm.pageIndex = pageIndex;\n      vm.renderedPages[pageIndex] = true;\n\n      $scope.$emit('flexForm.updatePage', page.key);\n      $scope.$broadcast('flexForm.updatePage', page.key);\n    }\n\n    function validatePage(page, noBadge) {\n      var curForm = vm.config.formCtrl[page.key];\n      if (curForm) {\n        console.error('curForm.$error:', curForm.$error);\n\n        var errors = _.chain(curForm.$error).reduce(function (left, right) {\n          return left.concat(right);\n        }).uniq('$name').reject({ $name: '' }).value();\n\n        if (errors && errors.length) {\n          page.errors = !noBadge && errors.length;\n        } else {\n          page.errors = 0;\n        }\n      }\n    }\n\n    // debug\n\n    function onSandboxSchema() {\n      if (vm.schemaStr) {\n        vm.config.schema = angular.fromJson(vm.schemaStr);\n      }\n    }\n  }\n})();\n'use strict';\n\n(function () {\n  'use strict';\n\n  angular.module('cn.forms').provider('cnFormsRoutes', cnFormsRoutesProvider);\n\n  cnFormsRoutesProvider.$inject = ['$stateProvider', 'cnFlexFormRoutesProvider'];\n  function cnFormsRoutesProvider($stateProvider, cnFlexFormRoutesProvider) {\n    var provider = {\n      addStates: addStates,\n      $get: $get\n    };\n\n    return provider;\n\n    ////////////\n\n    function $get() {\n      // nothing to do here, but required\n    }\n\n    function addStates(options) {\n      var pageParam = options.excludedPage ? '{page:(?!' + options.excludedPage + ')[^/]*}' : ':page';\n      var queryParams = ['debug', 'sandbox'].concat(options.queryParams || []).join('&');\n      $stateProvider.state(options.name, {\n        abstract: true,\n        url: options.baseUrl + '?' + queryParams,\n        controller: options.controller,\n        controllerAs: 'vm',\n        resolve: options.resolve,\n        permissions: options.permissions,\n        params: options.params,\n        templateUrl: options.templateUrl,\n        reloadOnSearch: false\n      }).state(options.name + '.page', {\n        url: '/' + pageParam,\n        permissions: options.permissions,\n        template: '<ui-view/>'\n      });\n\n      cnFlexFormRoutesProvider.addStates(options);\n    }\n  }\n})();\n'use strict';\n\n(function () {\n  'use strict';\n\n  angular.module('cn.forms').factory('cnFormsService', cnFormsService);\n\n  function cnFormsService() {\n    var service = {\n      compile: compile,\n      getPage: getPage,\n      getPageIndex: getPageIndex,\n      update: update,\n      destroy: destroy\n    };\n\n    return service;\n\n    //////////////\n\n    function compile(schema, page) {\n      service.schema = schema;\n      update(page);\n    }\n\n    function update(page) {\n      if (service.schema.forms) {\n        for (var i = 0, l = service.schema.forms.length; i < l; i++) {\n          var form = service.schema.forms[i];\n          if (page === form.key) {\n            service.form = form;\n            service.formIndex = i;\n            break;\n          }\n        }\n      } else {\n        service.form = service.schema.form;\n      }\n    }\n\n    function getPage() {\n      return service.form;\n    }\n\n    function getPageIndex() {\n      return service.formIndex;\n    }\n\n    function destroy() {\n      service.form = null;\n      service.schema = null;\n      service.formIndex = null;\n    }\n  }\n})();\n\"use strict\";\n\nangular.module(\"cn.forms\").run([\"$templateCache\", function ($templateCache) {\n  $templateCache.put(\"cn-forms/templates/cn-forms.html\", \"<form name=\\\"vm.cnForm\\\">\\n  <section class=\\\"cn-form-head cn-heading row vertical-parent\\\">\\n    <div class=\\\"container-fluid max-width\\\">\\n      <cn-flex-form-header ff-header-config=\\\"vm.config\\\"\\n                           ff-submit=\\\"vm.submit(vm.cnForm, handler)\\\"\\n                           ff-load-offscreen=\\\"vm.loadOffscreen()\\\">\\n      </cn-flex-form-header>\\n    </div>\\n  </section>\\n  <div class=\\\"cn-form cn-form-cols-3\\\"\\n       cn-responsive-height\\n       cn-responsive-break=\\\"sm\\\">\\n    <div class=\\\"cn-form-inner\\\">\\n\\n      <div class=\\\"col-sm-2 cn-form-nav\\\" ng-if=\\\"vm.config.schema.forms\\\">\\n        <div class=\\\"cn-form-nav-inner\\\"\\n             cn-parent-width\\n             cn-responsive-height\\n             cn-responsive-break=\\\"sm\\\">\\n          <ul class=\\\"nav nav-pills nav-stacked\\\">\\n            <li class=\\\"{{page.key === vm.page.key ? \\'active\\' : \\'\\'}}\\\"\\n                ng-repeat=\\\"page in vm.config.schema.forms\\\">\\n              <a ng-click=\\\"vm.updatePage(page, $index)\\\">\\n                {{page.title || page.key | titleCase}}\\n                <span class=\\\"badge has-error\\\" ng-show=\\\"page.errors\\\">{{page.errors}}</span>\\n              </a>\\n            </li>\\n          </ul>\\n        </div>\\n      </div>\\n\\n      <div class=\\\"cn-form-body col-sm-6\\\">\\n        <div class=\\\"{{$index !== vm.pageIndex ? \\'offscreen\\' : \\'\\'}}\\\"\\n             ng-if=\\\"vm.config.schema.forms\\\"\\n             ng-repeat=\\\"form in vm.config.schema.forms\\\">\\n          <cn-flex-form\\n            ff-form-index=\\\"$index\\\"\\n            ff-form-name=\\\"form.key\\\"\\n            ff-config=\\\"vm.config\\\"\\n            ff-model=\\\"vm.model\\\"\\n            ff-delay-form=\\\"!vm.renderedPages[$index] && !vm.activateOffscreen\\\"\\n            ff-cleanup-event=\\\"vm.cleanupEvent\\\">\\n          </cn-flex-form>\\n        </div>\\n\\n        <cn-flex-form\\n          ng-if=\\\"!vm.config.schema.forms\\\"\\n          ff-form-index=\\\"$index\\\"\\n          ff-form-name=\\\"vm.formKey\\\"\\n          ff-config=\\\"vm.config\\\"\\n          ff-model=\\\"vm.model\\\"\\n          ff-cleanup-event=\\\"vm.cleanupEvent\\\">\\n        </cn-flex-form>\\n\\n        <!-- sandbox for debug mode -->\\n        <fieldset ng-if=\\\"vm.sandbox\\\">\\n          <legend>Sandbox</legend>\\n\\n          <div class=\\\"form-group\\\">\\n            <label class=\\\"control-label\\\" for=\\\"schema\\\">Form Data</label>\\n            <textarea id=\\\"schema\\\"\\n                      class=\\\"form-control\\\"\\n                      ng-model=\\\"vm.schemaStr\\\"\\n                      rows=\\\"14\\\">\\n            </textarea>\\n          </div>\\n          <div class=\\\"form-group\\\">\\n            <button class=\\\"btn btn-primary\\\"\\n                    ng-click=\\\"vm.onSandboxSchema()\\\">Update Form\\n            </button>\\n          </div>\\n        </fieldset>\\n        <!-- end sandbox -->\\n      </div>\\n\\n      <div class=\\\"cn-form-meta\\\" ng-class=\\\"{\\'col-sm-4\\': vm.config.schema.forms, \\'col-sm-6\\': !vm.config.schema.forms}\\\">\\n        <div class=\\\"cn-form-meta-inner\\\"\\n             cn-parent-width\\n             cn-responsive-height\\n             cn-responsive-break=\\\"sm\\\"\\n             cn-set-max-height=\\\"true\\\">\\n          <div ng-bind-html=\\\"vm.config.schema.meta\\\"/>\\n          <div ng-transclude/>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n</form>\\n<div ng-if=\\\"!vm.config.disableModalView\\\">\\n  <ui-view/>\\n</div>\\n\");\n}]);","(function() {\n  'use strict';\n  angular.module('cn.forms', ['ui.router', 'cn.ui', 'cn.flex-form']);\n})();","(function() {\n  'use strict';\n\n  angular\n    .module('cn.forms')\n    .directive('cnForm', cnForm);\n\n  function cnForm() {\n    return {\n      restrict: 'E',\n      templateUrl: 'cn-forms/templates/cn-forms.html',\n      transclude: true,\n      scope: {\n        config: '=ffConfig',\n        model: '=ffModel'\n      },\n      controller: Form,\n      controllerAs: 'vm',\n      bindToController: true\n    };\n  }\n\n  Form.$inject = [\n    'cnFormsService', '$rootScope', '$scope', '$state',\n    '$stateParams', '$timeout', '$log', '$location', '$compile'\n  ];\n  function Form(cnFormsService, $rootScope, $scope, $state,\n                $stateParams, $timeout, $log, $location, $compile) {\n    function cnFormTag() {}\n    $scope.__tag = new cnFormTag();\n\n    var vm = this;\n\n    vm.activate = activate;\n    vm.loadOffscreen = loadOffscreen;\n    vm.submit = submit;\n    vm.updatePage = updatePage;\n    vm.validatePage = validatePage;\n    vm.cleanupEvent = \"cn.forms.cleanup\";\n    vm.formKey = $stateParams.page;\n\n    // debug\n    vm.schemaStr = '';\n    vm.onSandboxSchema = onSandboxSchema;\n\n    $scope.$watch(() => !!vm.config.schema, vm.activate);\n\n    $scope.$on('$destroy', function() {\n      $scope.$broadcast(vm.cleanupEvent);\n      $scope.$emit(vm.cleanupEvent);\n      cnFormsService.destroy();\n    });\n\n    //////////\n\n    function activate(watch) {\n      vm.activateOffscreen = false;\n      vm.config.getScope = vm.config.getScope || (() => $scope);\n      vm.config.cols = 3;\n      vm.config.formCtrl = vm.cnForm;\n      vm.config.buttonContainerClass = \"page-action-btns\";\n      vm.config.isDisabled = isDisabled;\n\n      if(vm.config.schema) {\n        try {\n          vm.compiled = false;\n          cnFormsService.compile(vm.config.schema, $stateParams.page);\n          vm.pageIndex = cnFormsService.getPageIndex();\n          vm.page = cnFormsService.getPage();\n\n          vm.compiled = true;\n\n          if(vm.page.errors) {\n            vm.page.errors = 0;\n            $timeout(function() {\n              $scope.$broadcast('schemaFormValidate');\n            });\n          }\n\n          vm.renderedPages = _.reduce(\n            vm.config.schema.forms,\n            (acc, value, index) => _.set(acc, index, _.eq(vm.pageIndex, index)),\n            {}\n          );\n        }\n        catch(e) {\n          $log.error('There was an error with your form data:', e.message);\n        }\n      }\n\n      // sandbox\n      if($location.search().sandbox) {\n        vm.schemaStr = angular.toJson(vm.config.schema);\n        vm.sandbox = true;\n      }\n    }\n\n     function isDisabled(btnConfig) {\n      return btnConfig.isDisabled ? btnConfig.isDisabled(isFormInvalid) : isFormInvalid(btnConfig);\n    }\n\n    function isFormInvalid(btnConfig) {\n      return vm.saving || vm.cnForm.$invalid || ((!(btnConfig && btnConfig.allowPristine) || !vm.activateOffscreen) && vm.cnForm.$pristine);\n    }\n\n    function loadOffscreen() {\n      console.log('vm.activateOffscreen:', vm.activateOffscreen);\n      vm.activateOffscreen = true;\n    }\n\n    function submit(form, handler) {\n      console.log('submit:');\n      vm.loadOffscreen();\n\n      $scope.$broadcast('schemaFormValidate');\n      $scope.$emit('schemaFormValidate');\n\n      if((form.$valid || vm.config.allowInvalid) && !vm.saving) {\n        vm.saving = true;\n        handler(vm.model)\n            .then(function(response) {\n              console.log('submit:response:', response);\n              vm.config.formCtrl.$setPristine();\n              vm.saving = false;\n            }, function(rejection) {\n              vm.saving = false;\n            });\n      }\n      else {\n        _.each(vm.config.schema.forms, function(page) {\n          vm.validatePage(page, page === vm.page);\n        });\n      }\n    }\n\n    function updatePage(page, pageIndex) {\n      $scope.$broadcast('schemaFormValidate');\n      // if the forms re-render these will no longer be the same reference\n      if (vm.page !== vm.config.schema.forms[vm.pageIndex]) {\n        vm.page = vm.config.schema.forms[vm.pageIndex];\n      }\n\n      vm.validatePage(vm.page);\n\n      $stateParams.page = page.key;\n      $state.go($state.current.name, $stateParams);\n      vm.page = page;\n      vm.pageIndex = pageIndex;\n      vm.renderedPages[pageIndex] = true;\n\n      $scope.$emit('flexForm.updatePage', page.key);\n      $scope.$broadcast('flexForm.updatePage', page.key);\n    }\n\n    function validatePage(page, noBadge) {\n      var curForm = vm.config.formCtrl[page.key];\n      if(curForm) {\n        console.error('curForm.$error:', curForm.$error);\n\n        var errors = _.chain(curForm.$error)\n            .reduce(function(left, right) {\n              return left.concat(right);\n            })\n            .uniq('$name')\n            .reject({$name: ''})\n            .value();\n\n        if(errors && errors.length) {\n          page.errors = !noBadge && errors.length;\n        }\n        else {\n          page.errors = 0;\n        }\n      }\n    }\n\n    // debug\n\n    function onSandboxSchema() {\n      if(vm.schemaStr) {\n        vm.config.schema = angular.fromJson(vm.schemaStr);\n      }\n    }\n  }\n})();\n","(function() {\n  'use strict';\n  angular\n      .module('cn.forms')\n      .provider('cnFormsRoutes', cnFormsRoutesProvider);\n\n  cnFormsRoutesProvider.$inject = ['$stateProvider', 'cnFlexFormRoutesProvider'];\n  function cnFormsRoutesProvider($stateProvider, cnFlexFormRoutesProvider) {\n    var provider = {\n      addStates: addStates,\n      $get: $get\n    };\n\n    return provider;\n\n    ////////////\n\n    function $get() {\n      // nothing to do here, but required\n    }\n\n    function addStates(options) {\n      let pageParam = options.excludedPage ? `{page:(?!${options.excludedPage})[^/]*}` : ':page';\n      let queryParams = ['debug', 'sandbox'].concat(options.queryParams || []).join('&');\n      $stateProvider\n          .state(options.name, {\n            abstract: true,\n            url: `${options.baseUrl}?${queryParams}`,\n            controller: options.controller,\n            controllerAs: 'vm',\n            resolve: options.resolve,\n            permissions: options.permissions,\n            params: options.params,\n            templateUrl: options.templateUrl,\n            reloadOnSearch: false\n          })\n          .state(options.name + '.page', {\n            url: `/${pageParam}`,\n            permissions: options.permissions,\n            template: '<ui-view/>'\n          });\n\n      cnFlexFormRoutesProvider.addStates(options);\n    }\n  }\n\n})();\n","(function() {\n  'use strict';\n  angular\n      .module('cn.forms')\n      .factory('cnFormsService', cnFormsService);\n\n  function cnFormsService() {\n    var service = {\n      compile: compile,\n      getPage: getPage,\n      getPageIndex: getPageIndex,\n      update: update,\n      destroy: destroy\n    };\n\n    return service;\n\n    //////////////\n\n    function compile(schema, page) {\n      service.schema = schema;\n      update(page);\n    }\n\n    function update(page) {\n      if (service.schema.forms) {\n        for(var i = 0, l = service.schema.forms.length; i < l; i++) {\n          var form = service.schema.forms[i];\n          if(page === form.key) {\n            service.form = form;\n            service.formIndex = i;\n            break;\n          }\n        }\n      }\n      else {\n        service.form = service.schema.form;\n      }\n    }\n\n    function getPage() {\n      return service.form;\n    }\n\n    function getPageIndex() {\n      return service.formIndex;\n    }\n\n    function destroy() {\n      service.form = null;\n      service.schema = null;\n      service.formIndex = null;\n    }\n  }\n})();\n","angular.module(\"cn.forms\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"cn-forms/templates/cn-forms.html\",\"<form name=\\\"vm.cnForm\\\">\\n  <section class=\\\"cn-form-head cn-heading row vertical-parent\\\">\\n    <div class=\\\"container-fluid max-width\\\">\\n      <cn-flex-form-header ff-header-config=\\\"vm.config\\\"\\n                           ff-submit=\\\"vm.submit(vm.cnForm, handler)\\\"\\n                           ff-load-offscreen=\\\"vm.loadOffscreen()\\\">\\n      </cn-flex-form-header>\\n    </div>\\n  </section>\\n  <div class=\\\"cn-form cn-form-cols-3\\\"\\n       cn-responsive-height\\n       cn-responsive-break=\\\"sm\\\">\\n    <div class=\\\"cn-form-inner\\\">\\n\\n      <div class=\\\"col-sm-2 cn-form-nav\\\" ng-if=\\\"vm.config.schema.forms\\\">\\n        <div class=\\\"cn-form-nav-inner\\\"\\n             cn-parent-width\\n             cn-responsive-height\\n             cn-responsive-break=\\\"sm\\\">\\n          <ul class=\\\"nav nav-pills nav-stacked\\\">\\n            <li class=\\\"{{page.key === vm.page.key ? \\'active\\' : \\'\\'}}\\\"\\n                ng-repeat=\\\"page in vm.config.schema.forms\\\">\\n              <a ng-click=\\\"vm.updatePage(page, $index)\\\">\\n                {{page.title || page.key | titleCase}}\\n                <span class=\\\"badge has-error\\\" ng-show=\\\"page.errors\\\">{{page.errors}}</span>\\n              </a>\\n            </li>\\n          </ul>\\n        </div>\\n      </div>\\n\\n      <div class=\\\"cn-form-body col-sm-6\\\">\\n        <div class=\\\"{{$index !== vm.pageIndex ? \\'offscreen\\' : \\'\\'}}\\\"\\n             ng-if=\\\"vm.config.schema.forms\\\"\\n             ng-repeat=\\\"form in vm.config.schema.forms\\\">\\n          <cn-flex-form\\n            ff-form-index=\\\"$index\\\"\\n            ff-form-name=\\\"form.key\\\"\\n            ff-config=\\\"vm.config\\\"\\n            ff-model=\\\"vm.model\\\"\\n            ff-delay-form=\\\"!vm.renderedPages[$index] && !vm.activateOffscreen\\\"\\n            ff-cleanup-event=\\\"vm.cleanupEvent\\\">\\n          </cn-flex-form>\\n        </div>\\n\\n        <cn-flex-form\\n          ng-if=\\\"!vm.config.schema.forms\\\"\\n          ff-form-index=\\\"$index\\\"\\n          ff-form-name=\\\"vm.formKey\\\"\\n          ff-config=\\\"vm.config\\\"\\n          ff-model=\\\"vm.model\\\"\\n          ff-cleanup-event=\\\"vm.cleanupEvent\\\">\\n        </cn-flex-form>\\n\\n        <!-- sandbox for debug mode -->\\n        <fieldset ng-if=\\\"vm.sandbox\\\">\\n          <legend>Sandbox</legend>\\n\\n          <div class=\\\"form-group\\\">\\n            <label class=\\\"control-label\\\" for=\\\"schema\\\">Form Data</label>\\n            <textarea id=\\\"schema\\\"\\n                      class=\\\"form-control\\\"\\n                      ng-model=\\\"vm.schemaStr\\\"\\n                      rows=\\\"14\\\">\\n            </textarea>\\n          </div>\\n          <div class=\\\"form-group\\\">\\n            <button class=\\\"btn btn-primary\\\"\\n                    ng-click=\\\"vm.onSandboxSchema()\\\">Update Form\\n            </button>\\n          </div>\\n        </fieldset>\\n        <!-- end sandbox -->\\n      </div>\\n\\n      <div class=\\\"cn-form-meta\\\" ng-class=\\\"{\\'col-sm-4\\': vm.config.schema.forms, \\'col-sm-6\\': !vm.config.schema.forms}\\\">\\n        <div class=\\\"cn-form-meta-inner\\\"\\n             cn-parent-width\\n             cn-responsive-height\\n             cn-responsive-break=\\\"sm\\\"\\n             cn-set-max-height=\\\"true\\\">\\n          <div ng-bind-html=\\\"vm.config.schema.meta\\\"/>\\n          <div ng-transclude/>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n</form>\\n<div ng-if=\\\"!vm.config.disableModalView\\\">\\n  <ui-view/>\\n</div>\\n\");}]);"]}