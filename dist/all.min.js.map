{"version":3,"sources":["all.min.js","_cn-forms.module.js","cn-forms.directive.js","cn-forms.routes.js","cn-forms.service.js","templates.js"],"names":["angular","module","cnForm","restrict","templateUrl","transclude","scope","config","model","controller","Form","controllerAs","bindToController","cnFormsService","$scope","$state","$stateParams","$timeout","$log","$location","$compile","cnFormTag","activate","watch","vm","activateOffscreen","getScope","formCtrl","buttonContainerClass","isDisabled","setupStyles","schema","compiled","compile","page","pageIndex","getPageIndex","getPage","errors","$broadcast","renderedPages","_","reduce","forms","acc","value","index","set","eq","e","error","message","search","sandbox","schemaStr","toJson","styles","head","isModal","offset","body","col1","col2","col3","nav","cols","btnConfig","isFormInvalid","saving","$invalid","allowPristine","$pristine","loadOffscreen","submit","form","handler","$emit","$valid","allowInvalid","each","validatePage","then","response","$setPristine","rejection","updatePage","key","go","current","name","noBadge","curForm","console","$error","chain","left","right","concat","uniq","reject","$name","length","onSandboxSchema","fromJson","__tag","this","cleanupEvent","formKey","$watch","$on","destroy","directive","$inject","cnFormsRoutesProvider","$stateProvider","cnFlexFormRoutesProvider","$get","addStates","options","pageParam","excludedPage","queryParams","join","state","abstract","url","baseUrl","resolve","permissions","params","reloadOnSearch","template","provider","service","update","i","l","formIndex","factory","run","$templateCache","put"],"mappings":"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","file":"all.min.js","sourcesContent":["'use strict';\n\n(function () {\n  'use strict';\n\n  angular.module('cn.forms', ['ui.router', 'cn.ui', 'cn.flex-form']);\n})();\n'use strict';\n\n(function () {\n  'use strict';\n\n  angular.module('cn.forms').directive('cnForm', cnForm);\n\n  function cnForm() {\n    return {\n      restrict: 'E',\n      templateUrl: 'cn-forms/templates/cn-forms.html',\n      transclude: true,\n      scope: {\n        config: '=ffConfig',\n        model: '=ffModel'\n      },\n      controller: Form,\n      controllerAs: 'vm',\n      bindToController: true\n    };\n  }\n\n  Form.$inject = ['cnFormsService', '$scope', '$state', '$stateParams', '$timeout', '$log', '$location', '$compile'];\n  function Form(cnFormsService, $scope, $state, $stateParams, $timeout, $log, $location, $compile) {\n\n    function cnFormTag() {}\n    $scope.__tag = new cnFormTag();\n\n    var vm = this;\n\n    vm.activate = activate;\n    vm.loadOffscreen = loadOffscreen;\n    vm.submit = submit;\n    vm.updatePage = updatePage;\n    vm.validatePage = validatePage;\n    vm.cleanupEvent = \"cn.forms.cleanup\";\n    vm.formKey = $stateParams.page;\n\n    // debug\n    vm.schemaStr = '';\n    vm.onSandboxSchema = onSandboxSchema;\n\n    $scope.$watch(function () {\n      return !!vm.config.schema;\n    }, vm.activate);\n\n    $scope.$on('$destroy', function () {\n      $scope.$broadcast(vm.cleanupEvent);\n      $scope.$emit(vm.cleanupEvent);\n      cnFormsService.destroy();\n    });\n\n    //////////\n\n    function activate(watch) {\n      vm.activateOffscreen = false;\n      vm.config.getScope = vm.config.getScope || function () {\n        return $scope;\n      };\n      vm.config.formCtrl = vm.cnForm;\n      vm.config.buttonContainerClass = \"page-action-btns\";\n      vm.config.isDisabled = isDisabled;\n\n      setupStyles(vm.config);\n      //if(vm.config.isModal) setupModal(vm.config);\n\n      if (vm.config.schema) {\n        try {\n          vm.compiled = false;\n          cnFormsService.compile(vm.config.schema, $stateParams.page);\n          vm.pageIndex = cnFormsService.getPageIndex();\n          vm.page = cnFormsService.getPage();\n\n          vm.compiled = true;\n\n          if (vm.page.errors) {\n            vm.page.errors = 0;\n            $timeout(function () {\n              $scope.$broadcast('schemaFormValidate');\n            });\n          }\n\n          vm.renderedPages = _.reduce(vm.config.schema.forms, function (acc, value, index) {\n            return _.set(acc, index, _.eq(vm.pageIndex, index));\n          }, {});\n        } catch (e) {\n          $log.error('There was an error with your form data:', e.message);\n        }\n      }\n\n      // sandbox\n      if ($location.search().sandbox) {\n        vm.schemaStr = angular.toJson(vm.config.schema);\n        vm.sandbox = true;\n      }\n    }\n\n    function setupStyles(config) {\n      vm.styles = config.styles || {};\n      vm.styles.head = vm.styles.head || config.isModal ? 'modal-header clearfix' : 'cn-form-head cn-heading row vertical-parent';\n      vm.styles.offset = vm.styles.offset || config.isModal ? false : 0;\n      vm.styles.body = vm.styles.body || vm.styles.offset === false ? '' : 'cn-form-fixed';\n      vm.styles.col1 = vm.styles.col1 || config.isModal ? '' : 'col-sm-2';\n      vm.styles.col2 = vm.styles.col2 || config.isModal ? '' : 'col-sm-6';\n      vm.styles.col3 = vm.styles.col3 || config.isModal ? '' : vm.config.schema.forms ? 'col-sm-4' : 'col-sm-6';\n      vm.styles.nav = vm.styles.nav || config.isModal ? '' : 'nav-stacked';\n      vm.styles.cols = vm.styles.cols || config.isModal ? 2 : 3;\n    }\n\n    function isDisabled(btnConfig) {\n      return btnConfig.isDisabled ? btnConfig.isDisabled(isFormInvalid) : isFormInvalid(btnConfig);\n    }\n\n    function isFormInvalid(btnConfig) {\n      return vm.saving || vm.cnForm.$invalid || (!(btnConfig && btnConfig.allowPristine) || !vm.activateOffscreen) && vm.cnForm.$pristine;\n    }\n\n    function loadOffscreen() {\n      vm.activateOffscreen = true;\n    }\n\n    function submit(form, handler) {\n      vm.loadOffscreen();\n\n      $scope.$broadcast('schemaFormValidate');\n      $scope.$emit('schemaFormValidate');\n\n      if ((form.$valid || vm.config.allowInvalid) && !vm.saving) {\n        vm.saving = true;\n        handler(vm.model).then(function (response) {\n          vm.config.formCtrl.$setPristine();\n          vm.saving = false;\n        }, function (rejection) {\n          vm.saving = false;\n        });\n      } else {\n        _.each(vm.config.schema.forms, function (page) {\n          vm.validatePage(page, page === vm.page);\n        });\n      }\n    }\n\n    function updatePage(page, pageIndex) {\n      $scope.$broadcast('schemaFormValidate');\n      // if the forms re-render these will no longer be the same reference\n      if (vm.page !== vm.config.schema.forms[vm.pageIndex]) {\n        vm.page = vm.config.schema.forms[vm.pageIndex];\n      }\n\n      vm.validatePage(vm.page);\n\n      $stateParams.page = page.key;\n      $state.go($state.current.name, $stateParams);\n      vm.page = page;\n      vm.pageIndex = pageIndex;\n      vm.renderedPages[pageIndex] = true;\n\n      $scope.$emit('flexForm.updatePage', page.key);\n      $scope.$broadcast('flexForm.updatePage', page.key);\n    }\n\n    function validatePage(page, noBadge) {\n      var curForm = vm.config.formCtrl[page.key];\n      if (curForm) {\n        console.error('curForm.$error:', curForm.$error);\n\n        var errors = _.chain(curForm.$error).reduce(function (left, right) {\n          return left.concat(right);\n        }).uniq('$name').reject({ $name: '' }).value();\n\n        if (errors && errors.length) {\n          page.errors = !noBadge && errors.length;\n        } else {\n          page.errors = 0;\n        }\n      }\n    }\n\n    // debug\n\n    function onSandboxSchema() {\n      if (vm.schemaStr) {\n        vm.config.schema = angular.fromJson(vm.schemaStr);\n      }\n    }\n  }\n})();\n'use strict';\n\n(function () {\n  'use strict';\n\n  angular.module('cn.forms').provider('cnFormsRoutes', cnFormsRoutesProvider);\n\n  cnFormsRoutesProvider.$inject = ['$stateProvider', 'cnFlexFormRoutesProvider'];\n  function cnFormsRoutesProvider($stateProvider, cnFlexFormRoutesProvider) {\n    var provider = {\n      addStates: addStates,\n      $get: $get\n    };\n\n    return provider;\n\n    ////////////\n\n    function $get() {\n      // nothing to do here, but required\n    }\n\n    function addStates(options) {\n      var pageParam = options.excludedPage ? '{page:(?!' + options.excludedPage + ')[^/]*}' : ':page';\n      var queryParams = ['debug', 'sandbox'].concat(options.queryParams || []).join('&');\n      $stateProvider.state(options.name, {\n        abstract: true,\n        url: options.baseUrl + '?' + queryParams,\n        controller: options.controller,\n        controllerAs: options.controllerAs || 'vm',\n        resolve: options.resolve,\n        permissions: options.permissions,\n        params: options.params,\n        templateUrl: options.templateUrl,\n        reloadOnSearch: false\n      }).state(options.name + '.page', {\n        url: '/' + pageParam,\n        permissions: options.permissions,\n        template: '<ui-view/>'\n      });\n\n      cnFlexFormRoutesProvider.addStates(options);\n    }\n  }\n})();\n'use strict';\n\n(function () {\n  'use strict';\n\n  angular.module('cn.forms').factory('cnFormsService', cnFormsService);\n\n  function cnFormsService() {\n    var service = {\n      compile: compile,\n      getPage: getPage,\n      getPageIndex: getPageIndex,\n      update: update,\n      destroy: destroy\n    };\n\n    return service;\n\n    //////////////\n\n    function compile(schema, page) {\n      service.schema = schema;\n      update(page);\n    }\n\n    function update(page) {\n      if (service.schema.forms) {\n        for (var i = 0, l = service.schema.forms.length; i < l; i++) {\n          var form = service.schema.forms[i];\n          if (page === form.key) {\n            service.form = form;\n            service.formIndex = i;\n            break;\n          }\n        }\n      } else {\n        service.form = service.schema.form;\n      }\n    }\n\n    function getPage() {\n      return service.form;\n    }\n\n    function getPageIndex() {\n      return service.formIndex;\n    }\n\n    function destroy() {\n      service.form = null;\n      service.schema = null;\n      service.formIndex = null;\n    }\n  }\n})();\n\"use strict\";\n\nangular.module(\"cn.forms\").run([\"$templateCache\", function ($templateCache) {\n  $templateCache.put(\"cn-forms/templates/cn-forms.html\", \"<form name=\\\"vm.cnForm\\\">\\n  <section class=\\\"{{vm.styles.head}}\\\">\\n    <cn-flex-form-header\\n      ff-header-config=\\\"vm.config\\\"\\n      ff-submit=\\\"vm.submit(vm.cnForm, handler)\\\"\\n      ff-load-offscreen=\\\"vm.loadOffscreen()\\\"\\n    />\\n  </section>\\n  <div\\n    class=\\\"cn-form cn-form-cols-{{vm.styles.cols}} {{vm.styles.body}}\\\"\\n    cn-responsive-height=\\\"{{vm.styles.offset}}\\\"\\n    cn-responsive-break=\\\"sm\\\"\\n  >\\n    <div class=\\\"cn-form-inner\\\">\\n\\n      <div\\n        ng-if=\\\"vm.config.schema.forms\\\"\\n        class=\\\"cn-form-nav {{vm.styles.col1}}\\\"\\n      >\\n        <div\\n          class=\\\"cn-form-nav-inner\\\"\\n          cn-parent-width\\n          cn-responsive-height=\\\"{{vm.styles.offset}}\\\"\\n          cn-responsive-break=\\\"sm\\\"\\n        >\\n          <ul class=\\\"nav nav-pills {{vm.styles.nav}}\\\">\\n            <li class=\\\"{{page.key === vm.page.key ? \\'active\\' : \\'\\'}}\\\"\\n                ng-repeat=\\\"page in vm.config.schema.forms\\\">\\n              <a ng-click=\\\"vm.updatePage(page, $index)\\\">\\n                {{page.title || page.key | titleCase}}\\n                <span class=\\\"badge has-error\\\" ng-show=\\\"page.errors\\\">{{page.errors}}</span>\\n              </a>\\n            </li>\\n          </ul>\\n        </div>\\n      </div>\\n\\n      <div class=\\\"cn-form-body {{vm.styles.col2}}\\\">\\n        <div class=\\\"{{$index !== vm.pageIndex ? \\'offscreen\\' : \\'\\'}}\\\"\\n             ng-if=\\\"vm.config.schema.forms\\\"\\n             ng-repeat=\\\"form in vm.config.schema.forms\\\">\\n          <cn-flex-form\\n            ff-form-index=\\\"$index\\\"\\n            ff-form-name=\\\"form.key\\\"\\n            ff-config=\\\"vm.config\\\"\\n            ff-model=\\\"vm.model\\\"\\n            ff-delay-form=\\\"!vm.renderedPages[$index] && !vm.activateOffscreen\\\"\\n            ff-cleanup-event=\\\"vm.cleanupEvent\\\">\\n          </cn-flex-form>\\n        </div>\\n\\n        <cn-flex-form\\n          ng-if=\\\"!vm.config.schema.forms\\\"\\n          ff-form-index=\\\"$index\\\"\\n          ff-form-name=\\\"vm.formKey\\\"\\n          ff-config=\\\"vm.config\\\"\\n          ff-model=\\\"vm.model\\\"\\n          ff-cleanup-event=\\\"vm.cleanupEvent\\\">\\n        </cn-flex-form>\\n\\n        <!-- sandbox for debug mode -->\\n        <fieldset ng-if=\\\"vm.sandbox\\\">\\n          <legend>Sandbox</legend>\\n\\n          <div class=\\\"form-group\\\">\\n            <label class=\\\"control-label\\\" for=\\\"schema\\\">Form Data</label>\\n            <textarea id=\\\"schema\\\"\\n                      class=\\\"form-control\\\"\\n                      ng-model=\\\"vm.schemaStr\\\"\\n                      rows=\\\"14\\\">\\n            </textarea>\\n          </div>\\n          <div class=\\\"form-group\\\">\\n            <button class=\\\"btn btn-primary\\\"\\n                    ng-click=\\\"vm.onSandboxSchema()\\\">Update Form\\n            </button>\\n          </div>\\n        </fieldset>\\n        <!-- end sandbox -->\\n      </div>\\n\\n      <div\\n        ng-if=\\\"vm.styles.cols > 2\\\"\\n        class=\\\"cn-form-meta {{vm.styles.col3}}\\\"\\n      >\\n        <div\\n          class=\\\"cn-form-meta-inner\\\"\\n          cn-parent-width\\n          cn-responsive-height=\\\"{{vm.styles.offset}}\\\"\\n          cn-responsive-break=\\\"sm\\\"\\n          cn-set-max-height=\\\"true\\\"\\n        >\\n          <div ng-bind-html=\\\"vm.config.schema.meta\\\"/>\\n          <div ng-transclude/>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n</form>\\n<div ng-if=\\\"!vm.config.isModal\\\">\\n  <ui-view/>\\n</div>\\n\");\n}]);","(function() {\n  'use strict';\n  angular.module('cn.forms', ['ui.router', 'cn.ui', 'cn.flex-form']);\n})();","(function() {\n  'use strict';\n\n  angular\n    .module('cn.forms')\n    .directive('cnForm', cnForm);\n\n  function cnForm() {\n    return {\n      restrict: 'E',\n      templateUrl: 'cn-forms/templates/cn-forms.html',\n      transclude: true,\n      scope: {\n        config: '=ffConfig',\n        model: '=ffModel'\n      },\n      controller: Form,\n      controllerAs: 'vm',\n      bindToController: true\n    };\n  }\n\n  Form.$inject = [\n    'cnFormsService', '$scope', '$state',\n    '$stateParams', '$timeout', '$log', '$location', '$compile'\n  ];\n  function Form(cnFormsService, $scope, $state,\n                $stateParams, $timeout, $log, $location, $compile) {\n\n    function cnFormTag() {}\n    $scope.__tag = new cnFormTag();\n\n    var vm = this;\n\n    vm.activate = activate;\n    vm.loadOffscreen = loadOffscreen;\n    vm.submit = submit;\n    vm.updatePage = updatePage;\n    vm.validatePage = validatePage;\n    vm.cleanupEvent = \"cn.forms.cleanup\";\n    vm.formKey = $stateParams.page;\n\n    // debug\n    vm.schemaStr = '';\n    vm.onSandboxSchema = onSandboxSchema;\n\n    $scope.$watch(() => !!vm.config.schema, vm.activate);\n\n    $scope.$on('$destroy', function() {\n      $scope.$broadcast(vm.cleanupEvent);\n      $scope.$emit(vm.cleanupEvent);\n      cnFormsService.destroy();\n    });\n\n    //////////\n\n    function activate(watch) {\n      vm.activateOffscreen = false;\n      vm.config.getScope = vm.config.getScope || (() => $scope);\n      vm.config.formCtrl = vm.cnForm;\n      vm.config.buttonContainerClass = \"page-action-btns\";\n      vm.config.isDisabled = isDisabled;\n\n      setupStyles(vm.config);\n      //if(vm.config.isModal) setupModal(vm.config);\n\n      if(vm.config.schema) {\n        try {\n          vm.compiled = false;\n          cnFormsService.compile(vm.config.schema, $stateParams.page);\n          vm.pageIndex = cnFormsService.getPageIndex();\n          vm.page = cnFormsService.getPage();\n\n          vm.compiled = true;\n\n          if(vm.page.errors) {\n            vm.page.errors = 0;\n            $timeout(function() {\n              $scope.$broadcast('schemaFormValidate');\n            });\n          }\n\n          vm.renderedPages = _.reduce(\n            vm.config.schema.forms,\n            (acc, value, index) => _.set(acc, index, _.eq(vm.pageIndex, index)),\n            {}\n          );\n        }\n        catch(e) {\n          $log.error('There was an error with your form data:', e.message);\n        }\n      }\n\n      // sandbox\n      if($location.search().sandbox) {\n        vm.schemaStr = angular.toJson(vm.config.schema);\n        vm.sandbox = true;\n      }\n    }\n\n    function setupStyles(config) {\n      vm.styles = config.styles || {};\n      vm.styles.head = vm.styles.head || config.isModal ?\n        'modal-header clearfix' : 'cn-form-head cn-heading row vertical-parent';\n      vm.styles.offset = vm.styles.offset || config.isModal ?\n        false : 0;\n      vm.styles.body = vm.styles.body || vm.styles.offset === false ?\n        '' : 'cn-form-fixed';\n      vm.styles.col1 = vm.styles.col1 || config.isModal ?\n        '' : 'col-sm-2';\n      vm.styles.col2 = vm.styles.col2 || config.isModal ?\n        '' : 'col-sm-6';\n      vm.styles.col3 = vm.styles.col3 || config.isModal ?\n        '' : (vm.config.schema.forms ? 'col-sm-4' : 'col-sm-6');\n      vm.styles.nav = vm.styles.nav || config.isModal ?\n        '' : 'nav-stacked';\n      vm.styles.cols = vm.styles.cols || config.isModal ?\n        2 : 3;\n    }\n\n     function isDisabled(btnConfig) {\n      return btnConfig.isDisabled ? btnConfig.isDisabled(isFormInvalid) : isFormInvalid(btnConfig);\n    }\n\n    function isFormInvalid(btnConfig) {\n      return vm.saving || vm.cnForm.$invalid || ((!(btnConfig && btnConfig.allowPristine) || !vm.activateOffscreen) && vm.cnForm.$pristine);\n    }\n\n    function loadOffscreen() {\n      vm.activateOffscreen = true;\n    }\n\n    function submit(form, handler) {\n      vm.loadOffscreen();\n\n      $scope.$broadcast('schemaFormValidate');\n      $scope.$emit('schemaFormValidate');\n\n      if((form.$valid || vm.config.allowInvalid) && !vm.saving) {\n        vm.saving = true;\n        handler(vm.model)\n            .then(function(response) {\n              vm.config.formCtrl.$setPristine();\n              vm.saving = false;\n            }, function(rejection) {\n              vm.saving = false;\n            });\n      }\n      else {\n        _.each(vm.config.schema.forms, function(page) {\n          vm.validatePage(page, page === vm.page);\n        });\n      }\n    }\n\n    function updatePage(page, pageIndex) {\n      $scope.$broadcast('schemaFormValidate');\n      // if the forms re-render these will no longer be the same reference\n      if (vm.page !== vm.config.schema.forms[vm.pageIndex]) {\n        vm.page = vm.config.schema.forms[vm.pageIndex];\n      }\n\n      vm.validatePage(vm.page);\n\n      $stateParams.page = page.key;\n      $state.go($state.current.name, $stateParams);\n      vm.page = page;\n      vm.pageIndex = pageIndex;\n      vm.renderedPages[pageIndex] = true;\n\n      $scope.$emit('flexForm.updatePage', page.key);\n      $scope.$broadcast('flexForm.updatePage', page.key);\n    }\n\n    function validatePage(page, noBadge) {\n      var curForm = vm.config.formCtrl[page.key];\n      if(curForm) {\n        console.error('curForm.$error:', curForm.$error);\n\n        var errors = _.chain(curForm.$error)\n            .reduce(function(left, right) {\n              return left.concat(right);\n            })\n            .uniq('$name')\n            .reject({$name: ''})\n            .value();\n\n        if(errors && errors.length) {\n          page.errors = !noBadge && errors.length;\n        }\n        else {\n          page.errors = 0;\n        }\n      }\n    }\n\n    // debug\n\n    function onSandboxSchema() {\n      if(vm.schemaStr) {\n        vm.config.schema = angular.fromJson(vm.schemaStr);\n      }\n    }\n  }\n})();\n","(function() {\n  'use strict';\n  angular\n      .module('cn.forms')\n      .provider('cnFormsRoutes', cnFormsRoutesProvider);\n\n  cnFormsRoutesProvider.$inject = ['$stateProvider', 'cnFlexFormRoutesProvider'];\n  function cnFormsRoutesProvider($stateProvider, cnFlexFormRoutesProvider) {\n    var provider = {\n      addStates: addStates,\n      $get: $get\n    };\n\n    return provider;\n\n    ////////////\n\n    function $get() {\n      // nothing to do here, but required\n    }\n\n    function addStates(options) {\n      let pageParam = options.excludedPage ?\n          `{page:(?!${options.excludedPage})[^/]*}` :\n          ':page';\n      let queryParams = ['debug', 'sandbox']\n          .concat(options.queryParams || [])\n          .join('&');\n      $stateProvider\n          .state(options.name, {\n            abstract: true,\n            url: `${options.baseUrl}?${queryParams}`,\n            controller: options.controller,\n            controllerAs: options.controllerAs || 'vm',\n            resolve: options.resolve,\n            permissions: options.permissions,\n            params: options.params,\n            templateUrl: options.templateUrl,\n            reloadOnSearch: false\n          })\n          .state(options.name + '.page', {\n            url: `/${pageParam}`,\n            permissions: options.permissions,\n            template: '<ui-view/>'\n          });\n\n      cnFlexFormRoutesProvider.addStates(options);\n    }\n  }\n\n})();\n","(function() {\n  'use strict';\n  angular\n      .module('cn.forms')\n      .factory('cnFormsService', cnFormsService);\n\n  function cnFormsService() {\n    var service = {\n      compile: compile,\n      getPage: getPage,\n      getPageIndex: getPageIndex,\n      update: update,\n      destroy: destroy\n    };\n\n    return service;\n\n    //////////////\n\n    function compile(schema, page) {\n      service.schema = schema;\n      update(page);\n    }\n\n    function update(page) {\n      if (service.schema.forms) {\n        for(var i = 0, l = service.schema.forms.length; i < l; i++) {\n          var form = service.schema.forms[i];\n          if(page === form.key) {\n            service.form = form;\n            service.formIndex = i;\n            break;\n          }\n        }\n      }\n      else {\n        service.form = service.schema.form;\n      }\n    }\n\n    function getPage() {\n      return service.form;\n    }\n\n    function getPageIndex() {\n      return service.formIndex;\n    }\n\n    function destroy() {\n      service.form = null;\n      service.schema = null;\n      service.formIndex = null;\n    }\n  }\n})();\n","angular.module(\"cn.forms\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"cn-forms/templates/cn-forms.html\",\"<form name=\\\"vm.cnForm\\\">\\n  <section class=\\\"{{vm.styles.head}}\\\">\\n    <cn-flex-form-header\\n      ff-header-config=\\\"vm.config\\\"\\n      ff-submit=\\\"vm.submit(vm.cnForm, handler)\\\"\\n      ff-load-offscreen=\\\"vm.loadOffscreen()\\\"\\n    />\\n  </section>\\n  <div\\n    class=\\\"cn-form cn-form-cols-{{vm.styles.cols}} {{vm.styles.body}}\\\"\\n    cn-responsive-height=\\\"{{vm.styles.offset}}\\\"\\n    cn-responsive-break=\\\"sm\\\"\\n  >\\n    <div class=\\\"cn-form-inner\\\">\\n\\n      <div\\n        ng-if=\\\"vm.config.schema.forms\\\"\\n        class=\\\"cn-form-nav {{vm.styles.col1}}\\\"\\n      >\\n        <div\\n          class=\\\"cn-form-nav-inner\\\"\\n          cn-parent-width\\n          cn-responsive-height=\\\"{{vm.styles.offset}}\\\"\\n          cn-responsive-break=\\\"sm\\\"\\n        >\\n          <ul class=\\\"nav nav-pills {{vm.styles.nav}}\\\">\\n            <li class=\\\"{{page.key === vm.page.key ? \\'active\\' : \\'\\'}}\\\"\\n                ng-repeat=\\\"page in vm.config.schema.forms\\\">\\n              <a ng-click=\\\"vm.updatePage(page, $index)\\\">\\n                {{page.title || page.key | titleCase}}\\n                <span class=\\\"badge has-error\\\" ng-show=\\\"page.errors\\\">{{page.errors}}</span>\\n              </a>\\n            </li>\\n          </ul>\\n        </div>\\n      </div>\\n\\n      <div class=\\\"cn-form-body {{vm.styles.col2}}\\\">\\n        <div class=\\\"{{$index !== vm.pageIndex ? \\'offscreen\\' : \\'\\'}}\\\"\\n             ng-if=\\\"vm.config.schema.forms\\\"\\n             ng-repeat=\\\"form in vm.config.schema.forms\\\">\\n          <cn-flex-form\\n            ff-form-index=\\\"$index\\\"\\n            ff-form-name=\\\"form.key\\\"\\n            ff-config=\\\"vm.config\\\"\\n            ff-model=\\\"vm.model\\\"\\n            ff-delay-form=\\\"!vm.renderedPages[$index] && !vm.activateOffscreen\\\"\\n            ff-cleanup-event=\\\"vm.cleanupEvent\\\">\\n          </cn-flex-form>\\n        </div>\\n\\n        <cn-flex-form\\n          ng-if=\\\"!vm.config.schema.forms\\\"\\n          ff-form-index=\\\"$index\\\"\\n          ff-form-name=\\\"vm.formKey\\\"\\n          ff-config=\\\"vm.config\\\"\\n          ff-model=\\\"vm.model\\\"\\n          ff-cleanup-event=\\\"vm.cleanupEvent\\\">\\n        </cn-flex-form>\\n\\n        <!-- sandbox for debug mode -->\\n        <fieldset ng-if=\\\"vm.sandbox\\\">\\n          <legend>Sandbox</legend>\\n\\n          <div class=\\\"form-group\\\">\\n            <label class=\\\"control-label\\\" for=\\\"schema\\\">Form Data</label>\\n            <textarea id=\\\"schema\\\"\\n                      class=\\\"form-control\\\"\\n                      ng-model=\\\"vm.schemaStr\\\"\\n                      rows=\\\"14\\\">\\n            </textarea>\\n          </div>\\n          <div class=\\\"form-group\\\">\\n            <button class=\\\"btn btn-primary\\\"\\n                    ng-click=\\\"vm.onSandboxSchema()\\\">Update Form\\n            </button>\\n          </div>\\n        </fieldset>\\n        <!-- end sandbox -->\\n      </div>\\n\\n      <div\\n        ng-if=\\\"vm.styles.cols > 2\\\"\\n        class=\\\"cn-form-meta {{vm.styles.col3}}\\\"\\n      >\\n        <div\\n          class=\\\"cn-form-meta-inner\\\"\\n          cn-parent-width\\n          cn-responsive-height=\\\"{{vm.styles.offset}}\\\"\\n          cn-responsive-break=\\\"sm\\\"\\n          cn-set-max-height=\\\"true\\\"\\n        >\\n          <div ng-bind-html=\\\"vm.config.schema.meta\\\"/>\\n          <div ng-transclude/>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n</form>\\n<div ng-if=\\\"!vm.config.isModal\\\">\\n  <ui-view/>\\n</div>\\n\");}]);"]}