<form name="vm.cnForm">
  <section class="cn-form-head cn-heading row vertical-parent">
    <div class="container-fluid max-width">
      <div class="col-md-6">
        <h5 ng-if="vm.config.title.lead">{{::vm.config.title.lead}}</h5>

        <h1>{{vm.config.title.main}}</h1>
        <h5 ng-if="vm.config.title.sub">{{::vm.config.title.sub}}</h5>
      </div>

      <div class="page-action-btns">
        <div class="btn-options"
             ng-mouseover="vm.loadOffscreen()">
          <a class="btn" ui-sref="{{vm.config.actionConfig.returnState}}">
            {{vm.config.actionConfig.returnText || 'Cancel'}}
          </a>
        <span ng-repeat="button in vm.config.actionConfig.actions">
          <a class="btn {{button.style && 'btn-'+button.style}}"
             ng-disabled="vm.saving || vm.cnForm.$invalid || ((!button.allowPristine || !vm.activateOffscreen) && vm.cnForm.$pristine)"
             ng-class="{'btn-primary': $index === vm.config.actionConfig.actions.length - 1}"
             ng-click="button.handler && vm.submit(vm.cnForm, button.handler)"
             tooltip="{{button.helptext}}"
             tooltip-placement="bottom">
            {{button.text || 'Save'}}
          </a>
        </span>
        </div>
        <p class="data-updated-at text-right" id="data-updated-at">
          <a ng-click="vm.updateData()">Update Data</a>
        </p>
      </div>
    </div>
  </section>
  <div class="cn-form cn-form-cols-3"
       cn-responsive-height
       cn-responsive-break="sm">
    <div class="cn-form-inner row">

      <div class="col-sm-3 cn-form-nav">
        <div class="cn-form-nav-inner"
             cn-parent-width
             cn-responsive-height
             cn-responsive-break="sm">
          <ul class="nav nav-pills nav-stacked">
            <li class="{{page.key === vm.page.key ? 'active' : ''}}"
                ng-repeat="page in vm.config.schema.forms">
              <a ng-click="vm.updatePage(page.key)">
                <i class="cni cni-{{page.key}}"></i>
                {{page.title || page.key | titleCase}}
                <span class="badge has-error" ng-show="page.errors">{{page.errors}}</span>
              </a>
            </li>
          </ul>
        </div>
      </div>

      <div class="cn-form-body col-sm-6">
        <div class="{{$index !== vm.pageIndex ? 'offscreen' : ''}}"
             ng-repeat="form in vm.config.schema.forms">
          <cn-flex-form
            ff-form-index="$index"
            ff-form-name="form.key"
            ff-config="vm.config"
            ff-model="vm.model"
            ff-delay-form="$index !== vm.pageIndex && !vm.activateOffscreen">
          </cn-flex-form>
        </div>

        <!-- debug panel to display model -->
        <pre ng-if="vm.debug">{{vm.model|json}}</pre>

        <!-- sandbox for debug mode -->
        <fieldset ng-if="vm.sandbox">
          <legend>Sandbox</legend>

          <div class="form-group">
            <label class="control-label" for="schema">Form Data</label>
            <textarea id="schema"
                      class="form-control"
                      ng-model="vm.schemaStr"
                      rows="14">
            </textarea>
          </div>
          <div class="form-group">
            <button class="btn btn-primary"
                    ng-click="vm.onSandboxSchema()">Update Form
            </button>
          </div>
        </fieldset>
        <!-- end sandbox -->
      </div>
      <!--<div class="col-sm-3 cn-form-meta">-->
      <!--<pre>-->
      <!--{{vm.cnForm.$invalid | json}}-->
      <!--{{vm.cnForm.$pristine | json}}-->
      <!--{{vm.cnForm.$dirty | json}}-->
      <!--</pre>-->
      <!--</div>-->
      <div class="col-sm-3 cn-form-meta">
        <div class="cn-form-meta-inner"
             cn-parent-width
             cn-responsive-height
             cn-responsive-break="sm"
             ng-transclude></div>
      </div>
    </div>
  </div>
</form>
<ui-view></ui-view>
